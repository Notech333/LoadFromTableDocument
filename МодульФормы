
#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ЗагрузитьНоменклатуру(Команда)
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ОбработатьЗагруженныйФайл", ЭтотОбъект);
	ПараметрыЗагрузки = ФайловаяСистемаКлиент.ПараметрыЗагрузкиФайла();
	Текст = "ru = ""MS Excel""; en = ""MS Excel""";
	ПараметрыЗагрузки.Диалог.Фильтр = НСтр(Текст)+"(*.xlsx)|*.xlsx";
    ПараметрыЗагрузки.ИдентификаторФормы = УникальныйИдентификатор;
    ФайловаяСистемаКлиент.ЗагрузитьФайлы(ОписаниеОповещения, ПараметрыЗагрузки);
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработатьЗагруженныйФайл(ПомещенныеФайлы, ДополнительныеПараметры) Экспорт
	
	Если ПомещенныеФайлы = Неопределено Или ПомещенныеФайлы.Количество() = 0 Тогда
        Возврат;
    КонецЕсли;	
	ИмяФайлаДляРаспаковки = ПомещенныеФайлы[0].ПолноеИмя;
	ВременнаяПапка = КаталогВременныхФайлов()+"TempXLSX\";
	Попытка
		УдалитьФайлы(ВременнаяПапка);
	Исключение
	КонецПопытки;
	
	СоздатьКаталог(ВременнаяПапка);
	
	Excel = Новый COMОбъект("Excel.Application");
	док = Excel.Application.Workbooks.Open(ИмяФайлаДляРаспаковки);
	лист = док.ActiveSheet;

	mRow = лист.UsedRange.Rows.Count;
	mCol = лист.UsedRange.Columns.Count;
	Область = Excel.Range(лист.cells(1,1), лист.cells(mRow,mCol));
	
	МассивДанных = Область.Value.Выгрузить();
	
	КоличествоКол = МассивДанных.Количество();
	МассивНаименование = МассивДанных.Получить(0);
	МассивАртикул = МассивДанных.Получить(1);
	МассивГруппа = МассивДанных.Получить(2);
	МассивЕдиницаИзмерения = МассивДанных.Получить(3);
	МассивВес = МассивДанных.Получить(4);
	МассивОбъем = МассивДанных.Получить(5);
	МассивШтрихКод = МассивДанных.Получить(6);
	МассивОписание = МассивДанных.Получить(7);
	МассивБренд = МассивДанных.Получить(9);
	МассивПроизводитель = МассивДанных.Получить(17);
	МассивСтранаПроисхождения = МассивДанных.Получить(21);
	МассивИзображениеСсылка = МассивДанных.Получить(19);
	МассивВидНоменклатуры = МассивДанных.Получить(24);
	
	Для Каждого Строка из МассивДанных Цикл
		КоличествоСтр = Строка.Количество()
	КонецЦикла;
	
	Сч = 1;
	Пока Сч < КоличествоСтр Цикл
		Строка = Объект.ТЧЭксель.Добавить();
		Строка.Наименование = МассивНаименование.Получить(Сч);
		Строка.Артикул = МассивАртикул.Получить(Сч);
		Строка.Группа = МассивГруппа.Получить(Сч); 
		Строка.ЕдиницаИзмерения = МассивЕдиницаИзмерения.Получить(Сч);
		Строка.Вес = МассивВес.Получить(Сч);
		Строка.Объем = МассивОбъем.Получить(Сч);
		Строка.СтранаПроисхождения = МассивСтранаПроисхождения.Получить(Сч);
		Строка.ШтрихКод = МассивШтрихКод.Получить(Сч);
		Строка.Описание = МассивОписание.Получить(Сч);
		Строка.Производитель = МассивПроизводитель.Получить(Сч);
		Строка.Марка = МассивБренд.Получить(Сч);
		Строка.ИзображениеСсылка = МассивИзображениеСсылка.Получить(Сч);
		Строка.ВидНоменклатуры = МассивВидНоменклатуры.Получить(Сч);
		Сч = Сч + 1;	
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьСправочник(Таблица)	
	Для Каждого Строка Из Таблица Цикл
		Если ЗначениеЗаполнено(Строка.Наименование) тогда
			Ссылка = Справочники.Номенклатура.НайтиПоНаименованию(Строка.Наименование);
			Сообщить(Ссылка);
			Если ЗначениеЗаполнено(Ссылка) Тогда
				Документ = Ссылка.ПолучитьОбъект();
				Если Не ЗначениеЗаполнено(Документ.СтавкаНДС) Тогда
					Документ.СтавкаНДС = Перечисления.СтавкиНДС.НДС20;
				КонецЕсли;
				ЗначениеЕдИзм = Справочники.УпаковкиЕдиницыИзмерения.НайтиПоНаименованию(Строка.ЕдиницаИзмерения);
				Если Не Документ.ЕдиницаИзмерения = ЗначениеЕдИзм Тогда
					Документ.ЕдиницаИзмерения = ЗначениеЕдИзм;
				КонецЕсли;				
				Если Не Документ.Описание = Строка.Описание Тогда
					Документ.Описание = Строка.Описание;
				КонецЕсли;
				ЗначениеПроизводитель = Справочники.Производители.НайтиПоНаименованию(Строка.Марка);
				Если Не Документ.Производитель = ЗначениеПроизводитель Тогда
					Документ.Производитель = ЗначениеПроизводитель;
				КонецЕсли;				
				//ЗначениеВидНоменклатуры = Справочники.ВидыНоменклатуры.НайтиПоНаименованию("Архив");
				//Документ.ВидНоменклатуры = ЗначениеВидНоменклатуры;				
				Если ЗначениеЗаполнено(Строка.ВидНоменклатуры) Тогда
					Значение = Справочники.ВидыНоменклатуры.НайтиПоНаименованию(Строка.ВидНоменклатуры);
					Если ЗначениеЗаполнено(Значение) Тогда
						Документ.ВидНоменклатуры = Значение;
					КонецЕсли;
				КонецЕсли;
				//Соединение = Новый HTTPСоединение("promrukav.ru");
				//hh = Новый HTTPЗапрос(Прав(Строка.ИзображениеСсылка, СтрДлина(Строка.ИзображениеСсылка) - 23));
				//ИмяВременногоФайла = ПолучитьИмяВременногоФайла(".jpg");
				//Соединение.Получить(hh,ИмяВременногоФайла);
				//Ответ = Новый Картинка(ИмяВременногоФайла, Истина);
				//дд = Ответ.ПолучитьДвоичныеДанные();
				//ФайлКартинки = ПоместитьВоВременноеХранилище(дд);
				//Документ.Записать();
				//НазваниеФайла = Прав(Строка.ИзображениеСсылка, СтрДлина(Строка.ИзображениеСсылка) - 23);
				//ПрисоединенныеФайлы = Справочники.НоменклатураПрисоединенныеФайлы.СоздатьЭлемент();
				//ПрисоединенныеФайлы.ДатаСоздания = ТекущаяДата();
				//ПрисоединенныеФайлы.ДатаМодификацииУниверсальная = ТекущаяДата();
				//ПрисоединенныеФайлы.Изменил = ПараметрыСеанса.ТекущийПользователь;
				//ПрисоединенныеФайлы.Зашифрован = Ложь;
				//ПрисоединенныеФайлы.ИндексКартинки = 42;
				//ПрисоединенныеФайлы.ОбменДанными.Загрузка = Истина;
				//ПрисоединенныеФайлы.ТипХраненияФайла = Перечисления.ТипыХраненияФайлов.ВИнформационнойБазе;
				//ПрисоединенныеФайлы.Наименование = НазваниеФайла; 
				//ПрисоединенныеФайлы.Расширение = ".jpg";
				//Картинка = ПолучитьИзВременногоХранилища(ФайлКартинки);
				////ПрисоединенныеФайлы.Размер = Картинка.РазмерФайла();
				//ПрисоединенныеФайлы.СтатусИзвлеченияТекста = Перечисления.СтатусыИзвлеченияТекстаФайлов.НеИзвлечен;
				//ПрисоединенныеФайлы.ФайлХранилище = Картинка;
				//ПрисоединенныеФайлы.ВладелецФайла = Документ.Ссылка;
				//ПрисоединенныеФайлы.Записать();
				//
				//МенеджерЗаписи = РегистрыСведений.ДвоичныеДанныеФайлов.СоздатьМенеджерЗаписи();
				//МенеджерЗаписи.Файл = ПрисоединенныеФайлы.Ссылка;
				//МенеджерЗаписи.ДвоичныеДанныеФайла = ПрисоединенныеФайлы.ФайлХранилище;
				//МенеджерЗаписи.Записать(Истина);
				//
				//
				//Документ.ФайлКартинки = ПрисоединенныеФайлы.Ссылка;				
				Документ.Записать();				
				Если ЗначениеЗаполнено(Строка.ШтрихКод) тогда
					Набор = РегистрыСведений.ШтрихкодыНоменклатуры.СоздатьМенеджерЗаписи();
					Набор.Штрихкод = Строка.ШтрихКод;
					Набор.Номенклатура = Документ.Ссылка;
					Набор.Записать();
				КонецЕсли;

			Иначе
				Документ = Справочники.Номенклатура.СоздатьЭлемент();
				Документ.Наименование = Строка.Наименование;
				Документ.НаименованиеПолное = Строка.Наименование;
				Документ.СтавкаНДС = Перечисления.СтавкиНДС.НДС20;
				Документ.Артикул = Строка.Артикул;
				ЗначениеГруппа = Справочники.Номенклатура.НайтиПоНаименованию("Архив");
				Документ.Родитель = ЗначениеГруппа;
				ЗначениеЕдИзм = Справочники.УпаковкиЕдиницыИзмерения.НайтиПоНаименованию(Строка.ЕдиницаИзмерения);
				Документ.ЕдиницаИзмерения = ЗначениеЕдИзм;
				Документ.ВесИспользовать = Истина;
				Документ.ВесЗнаменатель = 1;
				Документ.ВесЧислитель = Строка.Вес;
				Документ.ОбъемИспользовать = Истина;
				Документ.ОбъемЗнаменатель = 1;
				Документ.ОбъемЧислитель = Строка.Объем;
				Документ.Описание = Строка.Описание;
				ЗначениеПроизводитель = Справочники.Производители.НайтиПоНаименованию(Строка.Марка);
				Документ.Производитель = ЗначениеПроизводитель;
				//ЗначениеВидНоменклатуры = Справочники.ВидыНоменклатуры.НайтиПоНаименованию("Архив");
				//Документ.ВидНоменклатуры = ЗначениеВидНоменклатуры;
				Если ЗначениеЗаполнено(Строка.ВидНоменклатуры) Тогда
					Значение = Справочники.ВидыНоменклатуры.НайтиПоНаименованию(Строка.ВидНоменклатуры);
					Если ЗначениеЗаполнено(Значение) Тогда
						Документ.ВидНоменклатуры = Значение;
					КонецЕсли;
				КонецЕсли;
				//Соединение = Новый HTTPСоединение("promrukav.ru");
				//hh = Новый HTTPЗапрос(Прав(Строка.ИзображениеСсылка, СтрДлина(Строка.ИзображениеСсылка) - 23));
				//ИмяВременногоФайла = ПолучитьИмяВременногоФайла(".jpg");
				//Соединение.Получить(hh,ИмяВременногоФайла);
				//Ответ = Новый Картинка(ИмяВременногоФайла, Истина);
				//дд = Ответ.ПолучитьДвоичныеДанные();
				//ФайлКартинки = ПоместитьВоВременноеХранилище(дд);
				//Документ.Записать();
				//НазваниеФайла = Прав(Строка.ИзображениеСсылка, СтрДлина(Строка.ИзображениеСсылка) - 23);
				//ПрисоединенныеФайлы = Справочники.НоменклатураПрисоединенныеФайлы.СоздатьЭлемент();
				//ПрисоединенныеФайлы.ДатаСоздания = ТекущаяДата();
				//ПрисоединенныеФайлы.ДатаМодификацииУниверсальная = ТекущаяДата();
				//ПрисоединенныеФайлы.Изменил = ПараметрыСеанса.ТекущийПользователь;
				//ПрисоединенныеФайлы.Зашифрован = Ложь;
				//ПрисоединенныеФайлы.ИндексКартинки = 42;
				//ПрисоединенныеФайлы.ОбменДанными.Загрузка = Истина;
				//ПрисоединенныеФайлы.ТипХраненияФайла = Перечисления.ТипыХраненияФайлов.ВИнформационнойБазе;
				//ПрисоединенныеФайлы.Наименование = НазваниеФайла; 
				//ПрисоединенныеФайлы.Расширение = ".jpg";
				//Картинка = ПолучитьИзВременногоХранилища(ФайлКартинки);
				////ПрисоединенныеФайлы.Размер = Картинка.РазмерФайла();
				//ПрисоединенныеФайлы.СтатусИзвлеченияТекста = Перечисления.СтатусыИзвлеченияТекстаФайлов.НеИзвлечен;
				//ПрисоединенныеФайлы.ФайлХранилище = Картинка;
				//ПрисоединенныеФайлы.ВладелецФайла = Документ.Ссылка;
				//ПрисоединенныеФайлы.Записать();
				//
				//МенеджерЗаписи = РегистрыСведений.ДвоичныеДанныеФайлов.СоздатьМенеджерЗаписи();
				//МенеджерЗаписи.Файл = ПрисоединенныеФайлы.Ссылка;
				//МенеджерЗаписи.ДвоичныеДанныеФайла = ПрисоединенныеФайлы.ФайлХранилище;
				//МенеджерЗаписи.Записать(Истина);
				//
				//
				//Документ.ФайлКартинки = ПрисоединенныеФайлы.Ссылка;				
				Документ.Записать();
				Если ЗначениеЗаполнено(Строка.ШтрихКод) тогда
					Набор = РегистрыСведений.ШтрихкодыНоменклатуры.СоздатьМенеджерЗаписи();
					Набор.Штрихкод = Строка.ШтрихКод;
					Набор.Номенклатура = Документ.Ссылка;
					Набор.Записать();
				КонецЕсли;
				//ШтрихКОД после записи	
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры


&НаСервере
Процедура ЗагрузитьМетодом_NativeXLSX_НаСервере(ИмяЛиста, СтрокаЗаголовка, НачСтрока, КонСтрока, КолвоСтрокExcel, Хран)
	
	ТаблицаРезультат = ЗагрузитьМетодом_NativeXLSX(ИмяЛиста, СтрокаЗаголовка, НачСтрока, КонСтрока, КолвоСтрокExcel, Хран);
	
	Для Каждого СтрокаЭкселя из ТаблицаРезультат Цикл
		Если СтрокаЭкселя.НомерСтроки = 1 Тогда 
			Продолжить;
		КонецЕсли;
		
		КодНоменклатуры = СтрокаЭкселя["N4"];
		
		Если ЗначениеЗаполнено(КодНоменклатуры) Тогда 
		
			НоменклатураСсылка = Справочники.Номенклатура.НайтиПоКоду(КодНоменклатуры);
			//НоменклатураОбъект = Справочники.Номенклатура.СоздатьЭлемент();
			НоменклатураОбъект = НоменклатураСсылка.ПолучитьОбъект();
			
			НаименованиеСтрокой = XMLСтрока(СтрокаЭкселя["N2"]);
			Если ЗначениеЗаполнено(НаименованиеСтрокой) Тогда 
				НоменклатураОбъект.Наименование = НаименованиеСтрокой;
			Иначе
				Сообщить("В исходном файле в строке "+СтрокаЭкселя.НомерСтроки+" не заполнено новое наименование");
			КонецЕсли;
			
			КодТНВЭДСтрокой = XMLСтрока(СтрокаЭкселя["N6"]);
			Если ЗначениеЗаполнено(КодТНВЭДСтрокой) Тогда 
				КодТНВЭД = Справочники.КлассификаторТНВЭД.НайтиСоздатьЭлементКлассификатораТНВЭД(КодТНВЭДСтрокой, Истина);
				Если не ЗначениеЗаполнено(КодТНВЭД) Тогда 
					Сообщить("В исходном файле в строке "+СтрокаЭкселя.НомерСтроки+" код ТНВЭД("+КодТНВЭДСтрокой+") не обнаружен в классификаторе");
				Иначе
					НоменклатураОбъект.КодТНВЭД = КодТНВЭД;
				КонецЕсли;
			КонецЕсли;
			
			КодОКПД2Строкой = XMLСтрока(СтрокаЭкселя["N7"]);
			Если ЗначениеЗаполнено(КодОКПД2Строкой) Тогда
				КодОКПД2 = Справочники.КлассификаторОКПД2.НайтиСоздатьЭлементКлассификатораОКПД2(КодОКПД2Строкой, Истина);
				Если не ЗначениеЗаполнено(КодОКПД2) Тогда 
					Сообщить("В исходном файле в строке "+СтрокаЭкселя.НомерСтроки+" код ОКПД2("+КодОКПД2Строкой+") не обнаружен в классификаторе");
				Иначе
					НоменклатураОбъект.КодОКПД2 = КодОКПД2;
				КонецЕсли;
			КонецЕсли;
			
			НоменклатураОбъект.Записать();
			
		Иначе
			
			Сообщить("В исходном файле в строке "+СтрокаЭкселя.НомерСтроки+" не указан код номенклатуры для сопоставления");
			
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

#Область ЗагрузкаEXEL

&НаКлиенте
Процедура ПарсингWorkbook()
	XML = Новый ЧтениеXML;
	XML.ОткрытьФайл(ВременнаяПапка+"workbook.xml");
	ПостроительДОМ = Новый ПостроительDOM;
	ДокументДОМ = ПостроительДОМ.Прочитать(XML);
	Листы = ДокументДОМ.ПолучитьЭлементыПоИмени("sheet");
	Итератор = 0;
	ЛистыЭкселя.Очистить();
	Для Каждого Лист из Листы Цикл
		Итератор = Итератор+1;
		НоваяСтрокаЛистовЭкселя = ЛистыЭкселя.Добавить();
		НоваяСтрокаЛистовЭкселя.НомерЛиста = Итератор;
		НоваяСтрокаЛистовЭкселя.ИмяЛиста = Лист.ПолучитьАтрибут("name");
	КонецЦикла;
	XML.Закрыть();
КонецПроцедуры

&НаСервере
Функция ЗагрузитьМетодом_NativeXLSX(Знач ИмяНомерЛиста, Знач СтрокаЗаголовка = 1, Знач НачСтрока = 0, Знач КонСтрока = 0, КолвоСтрокEXCEL = 0, Хран)
    Перем ZIPКаталог, ФайлИмяЛиста, ФайлНомерЛиста, КолвоКолонокEXCEL, НомерСтроки, НомерКолонки, ИмяКолонки, ИндексКолонки, ШиринаКолонки, ДлинаСтроки;
    Перем МассивИменКолонокXLSX, МассивSharedStrings, МассивNumFmtId, СоответствиеNumFmtIdFormatCode, ТаблицаIMAGE, СтрокаIMAGE, КаталогMEDIA;
    Перем ДокументDOM, ЭлементыROW, ЭлементСтрока, ЭлементыCOL, ЭлементКолонка;
    Перем ЗначениеЯчейки, ТипЗначения, ФорматЯчейки, ФорматСтиля;
    Перем ТаблицаРезультат, НоваяСтрока;
    Перем ЧтениеXML, ПостроительDOM;
	
	//ФайлИмяЛиста    = ИмяНомерЛиста.ИмяЛиста;
	//ФайлНомерЛиста    = ИмяНомерЛиста.НомерЛиста;
   
////    ФайлНомерЛиста = ?(ФайлНомерЛиста = 0, 1, ФайлНомерЛиста);
   
////	ZIPКаталог = ВременнаяПапка;
   
////	СоответствиеNumFmtIdFormatCode = Новый Соответствие;
	//МассивNumFmtId = ИзвлечьДанныеИзФайла_StylesXML(ZIPКаталог, СоответствиеNumFmtIdFormatCode);
   
////    МассивSharedStrings = ИзвлечьДанныеИзФайла_SharedStringsXML(ZIPКаталог);
   
////	//ДокументDOM = ПолучитьДокументDOM_NativeXLSX(ZIPКаталог + "XL\WorkSheets\Sheet" + ФайлНомерЛиста + ".xml");
	////ДокументDOM = ПолучитьДокументDOM_NativeXLSX(ZIPКаталог + "Sheet" + ФайлНомерЛиста + ".xml");
	//ФайлSheetXML = ZIPКаталог + "Sheet" + ФайлНомерЛиста + ".xml";
	//
	//
   
////    ЧтениеXML = Новый ЧтениеXML;
	//ЧтениеXML.ОткрытьФайл(ФайлSheetXML);
   
////    ПостроительDOM = Новый ПостроительDOM;
	//Попытка
	//    ДокументDOM = ПостроительDOM.Прочитать(ЧтениеXML);
	//    //Сообщить("Версия XML: " + ДокументDOM.ВерсияXML);
	//Исключение
	//    Сообщить(ОписаниеОшибки());
	//    ДокументDOM = Неопределено;
	//КонецПопытки;
   
////    // Завершение работы.
	//// Закрытие Объектов.
	//ЧтениеXML.Закрыть();	
	ХранФайл = ПолучитьИзВременногоХранилища(Хран);
	
	
	ИмяФайла = ПолучитьИмяВременногоФайла(".xml");
	//записываем двоичные данные во временный файл
	ХранФайл.Записать(ИмяФайла);
	
	//дальше работаем с этим временным файлом
    ЧтениеXML = Новый ЧтениеXML;
    ЧтениеXML.ОткрытьФайл(ИмяФайла);
	
	
	ПостроительDOM = Новый ПостроительDOM;
    Попытка
        ДокументDOM = ПостроительDOM.Прочитать(ЧтениеXML);
        //Сообщить("Версия XML: " + ДокументDOM.ВерсияXML);
    Исключение
        Сообщить(ОписаниеОшибки());
        ДокументDOM = Неопределено;
    КонецПопытки;
   
    // Завершение работы.
    // Закрытие Объектов.
    ЧтениеXML.Закрыть();

          
    ЭлементыROW = ПолучитьЭлементыROW_NativeXLSX(ДокументDOM);
    Если ЭлементыROW = Неопределено ИЛИ ЭлементыROW.Количество() = 0 Тогда
        // Завершение работы.
        // Закрытие Объектов.
        ДокументDOM = Неопределено;
        Возврат Новый ТаблицаЗначений;
    КонецЕсли;
   
    МассивИменКолонокXLSX = ПолучитьМассивИменКолонокНаЛистеXLSX(ДокументDOM, ЭлементыROW);
    КолвоКолонокEXCEL = МассивИменКолонокXLSX.Количество();
   
    // Создание результирующей таблицы, в которую будут записываться считанные из EXCEL данные.
    ТаблицаРезультат = Новый ТаблицаЗначений;
   
    // Формирование колонок результирующей таблицы.
   
    // "НомерСтроки" - для наглядности и удобства.
    // В зависимости от разрабатываемой обработки.
    // "Сопоставлено" - может быть другим.
    // Здесь же могут быть добавлены другие колонки, не формируемые из содержимого файла EXCEL.
    ТаблицаРезультат.Колонки.Добавить("НомерСтроки", Новый ОписаниеТипов("Число"), "№", 4);
    ТаблицаРезультат.Колонки.Добавить("Сопоставлено", Новый ОписаниеТипов("Булево"), "Сопоставлено", 1);
    ТаблицаРезультат.Колонки.Добавить("УровеньГруппировки", Новый ОписаниеТипов("Число"), "Гр", 2);    // Группировка строк в файле EXCEL.
    Для ит = 1 ПО КолвоКолонокEXCEL Цикл
        ИмяКолонки = "N" + ит;
        Колонка = ТаблицаРезультат.Колонки.Добавить(ИмяКолонки);
    КонецЦикла;
   
    // Строки XLSX.
    НомерСтроки = 0;
    Для Каждого ЭлементСтрока ИЗ ЭлементыROW Цикл
        НомерСтроки = НомерСтроки + 1;
       
        // Начало диапазона считываемых данных.
        Если НЕ НачСтрока = 0 И НЕ НомерСтроки = 1 И НомерСтроки < НачСтрока Тогда
            Продолжить;
        КонецЕсли;
       
        // Окончание диапазона считываемых данных.
        Если КонСтрока > 0 И НомерСтроки > КонСтрока Тогда
            Прервать;
        КонецЕсли;
       
        // Окончание данных.
        Если КолвоСтрокEXCEL > 0 И НомерСтроки > КолвоСтрокEXCEL Тогда
            Прервать;
        КонецЕсли;
       
        НоваяСтрока = ТаблицаРезультат.Добавить();
        НоваяСтрока.НомерСтроки = НомерСтроки;
        НоваяСтрока.УровеньГруппировки = ЗначениеАтрибутаУзлаDOM(ЭлементСтрока, "outlineLevel");
       
        // Колонки XLSX.
        НомерКолонки = 0;
        ЭлементыCOL = ЭлементСтрока.ДочерниеУзлы;
        Для ит = 0 ПО КолвоКолонокEXCEL-1 Цикл
            НомерКолонки = НомерКолонки + 1;
           
            ЭлементКолонка = Неопределено;
            Попытка
                ЭлементКолонка = ЭлементыCOL[ит];
                ТипЗначения = ЗначениеАтрибутаУзлаDOM(ЭлементКолонка, "t");
                ФорматЯчейки = ЗначениеАтрибутаУзлаDOM(ЭлементКолонка, "s");
                ИмяКолонки = ЗначениеАтрибутаУзлаDOM(ЭлементКолонка, "r");
                ИмяКолонкиБезЦифр = ЗаменитьОдниСимволыДругими("0123456789", ИмяКолонки, "");
                ИндексКолонки = МассивИменКолонокXLSX.Найти(ИмяКолонкиБезЦифр) + 1;
            Исключение
                ЭлементКолонка = Неопределено;
                ИндексКолонки = НомерКолонки;
            КонецПопытки;
           
            ИмяКолонки = "N" + ИндексКолонки;
           
            ЗначениеЯчейки = Неопределено;
            Если НЕ ЭлементКолонка = Неопределено И НЕ ЭлементКолонка.ПервыйДочерний = Неопределено И (ВРег(ЭлементКолонка.ПервыйДочерний.ИмяУзла) = "V"  ИЛИ ВРег(ЭлементКолонка.ПервыйДочерний.ИмяУзла) = "F") Тогда    // "V" - Значение, "F" - Формула.
               
                Если ВРег(ЭлементКолонка.ПервыйДочерний.ИмяУзла) = "F" Тогда
                    Если НЕ ЭлементКолонка.ПоследнийДочерний = Неопределено И ВРег(ЭлементКолонка.ПоследнийДочерний.ИмяУзла) = "V" Тогда
                        ЗначениеЯчейки = ЭлементКолонка.ПоследнийДочерний.ТекстовоеСодержимое;
                    Иначе
                        Сообщить("Строка " + НомерСтроки + " Колонка " + ИндексКолонки + " значение формулы не определено.");
                    КонецЕсли;
                Иначе
                    ЗначениеЯчейки = ЭлементКолонка.ТекстовоеСодержимое;
                КонецЕсли;
               
                ФорматСтиля = "";
                Если (НЕ ФорматЯчейки = "" И НЕ ФорматЯчейки = Неопределено) Тогда
                    Попытка
                        ФорматСтиля = СоответствиеNumFmtIdFormatCode.Получить(МассивNumFmtId[Число(ФорматЯчейки)]);
                    Исключение
                        ФорматСтиля = "";
                    КонецПопытки;
                КонецЕсли;
               
                Если ЗначениеЗаполнено(ЗначениеЯчейки) Тогда
                   
                    Если ТипЗначения = Неопределено ИЛИ ВРег(ТипЗначения) = "N" ИЛИ ВРег(ТипЗначения) = "B" Тогда    // Тип "Число", "Булево".
                        Попытка
                            Значение1 = Число(ЗначениеЯчейки);
                        Исключение
                            Значение1 = ЗначениеЯчейки;
                        КонецПопытки;
                       
                        ЗначениеЯчейки = Значение1;
                       
                        Если ТипЗнч(ЗначениеЯчейки) = Тип("Строка")
                            И (Найти(ЗначениеЯчейки, "E-") > 0 ИЛИ Найти(ЗначениеЯчейки, "E+") > 0) Тогда
                            ЗначениеЯчейки = ПолучитьЧислоВСтепениИзСтроковогоЗначения(ЗначениеЯчейки);
                        КонецЕсли;
                       
                        Если ТипЗнч(ЗначениеЯчейки) = Тип("Число") Тогда
                            // ПРОЦЕНТ.
                            Если ЭтоПроцентXLSX(ЗначениеЯчейки, ФорматСтиля) Тогда
                                ЗначениеЯчейки = Окр(ЗначениеЯчейки * 100, 3);
                            // БУЛЕВО.
                            ИначеЕсли ЭтоБулевоXLSX(ЗначениеЯчейки, ФорматСтиля) Тогда
                                ЗначениеЯчейки = Булево(ЗначениеЯчейки);
                            // ВРЕМЯ.
                            ИначеЕсли ЭтоВремяXLSX(ЗначениеЯчейки, ФорматСтиля) Тогда
                                ЗначениеЯчейки = КонвертироватьЧислоXLSXвДатуВремя(ЗначениеЯчейки);
                            // ДАТА.
                            ИначеЕсли ЭтоДатаXLSX(ЗначениеЯчейки, ФорматСтиля) Тогда
                                ЗначениеЯчейки = КонвертироватьЧислоXLSXвДату(ЗначениеЯчейки);
                            // ЧИСЛО.
                            ИначеЕсли ТипЗначения = Неопределено
                                ИЛИ ( ЭтоЧислоXLSX(ЗначениеЯчейки, ФорматСтиля)
                                И НЕ ЭтоБулевоXLSX(ЗначениеЯчейки, ФорматСтиля)
                                И НЕ ЭтоВремяXLSX(ЗначениеЯчейки, ФорматСтиля)
                                И НЕ ЭтоДатаXLSX(ЗначениеЯчейки, ФорматСтиля) )
                                Тогда
                                // Без преобразования.
                            Иначе
                                // Прочие форматы.
                            КонецЕсли;
                           
                        Иначе
                           
                            Сообщить("Не удалось преобразовать значение к ""числовому""(число, процент, время, дата, булево) типу.");
                           
                        КонецЕсли;
                       
                    ИначеЕсли ВРег(ТипЗначения) = "S" Тогда
                       
                        // МассивSharedStrings может быть пустым.
                        Попытка
                            ЗначениеЯчейки = СокрЛП(МассивSharedStrings[Число(ЗначениеЯчейки)]);
                        Исключение
                            ЗначениеЯчейки = "";
                        КонецПопытки;
                       
                    ИначеЕсли ВРег(ТипЗначения) = "STR" Тогда
                       
                        Если ТипЗнч(ЗначениеЯчейки) = Тип("Строка") Тогда
                            ЗначениеЯчейки = СокрЛП(ЗначениеЯчейки);
                        КонецЕсли;
                       
                    КонецЕсли;
                   
                КонецЕсли;
               
                НоваяСтрока[ИмяКолонки] = ЗначениеЯчейки;
               
                // Используется при формировании таблицы на форме обработки.
                ШиринаКолонки = ТаблицаРезультат.Колонки[ИмяКолонки].Ширина;
                ДлинаСтроки    = СтрДлина(СокрЛП(НоваяСтрока[ИмяКолонки]));
                ТаблицаРезультат.Колонки[ИмяКолонки].Ширина = ?(ШиринаКолонки < ДлинаСтроки, ДлинаСтроки, ШиринаКолонки);
               
            КонецЕсли;
           
        КонецЦикла;
       
    КонецЦикла;
   
    // Завершение работы.
    // Закрытие Объектов.
    ДокументDOM = Неопределено;
   
    УдалитьКолонкиСНулевойШириной(ТаблицаРезультат);
   
    Возврат ТаблицаРезультат;
   
КонецФункции

&НаСервере
Функция ИзвлечьДанныеИзФайла_StylesXML(ZIPКаталог, СоответствиеNumFmtIdFormatCode)
    Перем Файл, ДокументDOM, ЭлементыNnumFmts, ЭлементыCellXfs, ЭлементыКоллекции, Элемент;
    Перем МассивNumFmtId, ит;
   
    МассивNumFmtId = Новый Массив;
    СоответствиеNumFmtIdFormatCode = Новый Соответствие;
   
	//Файл = Новый Файл(ZIPКаталог + "XL\Styles.xml");
	Файл = Новый Файл(ZIPКаталог + "Styles.xml");
    Если НЕ Файл.Существует() Тогда
        Возврат Новый Массив;
    КонецЕсли;
   
    ДокументDOM = ПолучитьДокументDOM_NativeXLSX(Файл.ПолноеИмя);
   
    Попытка
        ЭлементыNnumFmts = ДокументDOM.ПолучитьЭлементыПоИмени("numFmts");
    Исключение
        Сообщить(ОписаниеОшибки());
        Возврат Новый Массив;
    КонецПопытки;
   
    Если ЭлементыNnumFmts.Количество() > 0 Тогда
        ЭлементыКоллекции = ЭлементыNnumFmts[0].ДочерниеУзлы;
        Для Каждого Элемент ИЗ ЭлементыКоллекции Цикл
            СоответствиеNumFmtIdFormatCode.Вставить(ЗначениеАтрибутаУзлаDOM(Элемент, "numFmtId"), ВРег(ЗначениеАтрибутаУзлаDOM(Элемент, "formatCode")));
        КонецЦикла;
    КонецЕсли;
   
    Попытка
        ЭлементыCellXfs = ДокументDOM.ПолучитьЭлементыПоИмени("cellXfs");
    Исключение
        Сообщить(ОписаниеОшибки());
        Возврат Новый Массив;
    КонецПопытки;
   
    Если ЭлементыCellXfs.Количество() > 0 Тогда
        ЭлементыКоллекции = ЭлементыCellXfs[0].ДочерниеУзлы;
        Для Каждого Элемент ИЗ ЭлементыКоллекции Цикл
            МассивNumFmtId.Добавить(ЗначениеАтрибутаУзлаDOM(Элемент, "numFmtId"));
        КонецЦикла;
    КонецЕсли;
 
    // Проверка сопоставления кодов массива и соответствия.
    // MS Office может не формировать в xml-файле описание стиля форматирования для ячейки.
    // LibreOffice формирует в xml-файле необходимые описания стиля форматирования ячейки.
    Для Каждого ит ИЗ МассивNumFmtId Цикл
        Если СоответствиеNumFmtIdFormatCode.Получить(ит) = Неопределено Тогда
            Если ит = "0" Тогда    // Стандарт для числа (Целое число).
                СоответствиеNumFmtIdFormatCode.Вставить(ит, "GENERAL");
            ИначеЕсли ит = "9" ИЛИ ит = "10" Тогда    // Форматы для % ("0%", "0.00%").
                СоответствиеNumFmtIdFormatCode.Вставить(ит, "0%");
            ИначеЕсли ит = "14" ИЛИ ит = "16" Тогда    // Форматы для даты.
                СоответствиеNumFmtIdFormatCode.Вставить(ит, "DD.MM.YYYY");
            ИначеЕсли ит = "45" ИЛИ ит = "46" ИЛИ ит = "47" Тогда    // Форматы для времени.
                СоответствиеNumFmtIdFormatCode.Вставить(ит, "HH:MM:SS");
            КонецЕсли;
        КонецЕсли;
    КонецЦикла;
   
    Возврат МассивNumFmtId;
   
КонецФункции

&НаСервере
Функция ИзвлечьДанныеИзФайла_SharedStringsXML(ZIPКаталог)
    Перем Файл, ДокументDOM, ЭлементыSharedStrings, ЭлементыКоллекции, Элемент;
    Перем МассивSharedStrings;
   
    // Если в файле EXCEL не содержится значений, имеющих тип "СТРОКА", то файл "SharedStrings.xml" не формируется.
   
    МассивSharedStrings = Новый Массив;
   
	//Файл = Новый Файл(ZIPКаталог + "XL\SharedStrings.xml");
	Файл = Новый Файл(ZIPКаталог + "SharedStrings.xml");
    Если НЕ Файл.Существует() Тогда
        Возврат Новый Массив;
    КонецЕсли;
   
    ДокументDOM = ПолучитьДокументDOM_NativeXLSX(Файл.ПолноеИмя);
   
    Попытка
        ЭлементыSharedStrings = ДокументDOM.ПолучитьЭлементыПоИмени("sst");
    Исключение
        Сообщить(ОписаниеОшибки());
        Возврат Новый Массив;
    КонецПопытки;
   
    Если ЭлементыSharedStrings.Количество() > 0 Тогда
        ЭлементыКоллекции = ЭлементыSharedStrings[0].ДочерниеУзлы;
        Для Каждого Элемент ИЗ ЭлементыКоллекции Цикл
            МассивSharedStrings.Добавить(Элемент.ТекстовоеСодержимое);
        КонецЦикла;
    КонецЕсли;
   
    Возврат МассивSharedStrings;
   
КонецФункции

&НаСервере
Функция ПолучитьДокументDOM_NativeXLSX(ФайлSheetXML)
    Перем ЧтениеXML, ПостроительDOM, ДокументDOM;
   
    ЧтениеXML = Новый ЧтениеXML;
    ЧтениеXML.ОткрытьФайл(ФайлSheetXML);
   
    ПостроительDOM = Новый ПостроительDOM;
    Попытка
        ДокументDOM = ПостроительDOM.Прочитать(ЧтениеXML);
        //Сообщить("Версия XML: " + ДокументDOM.ВерсияXML);
    Исключение
        Сообщить(ОписаниеОшибки());
        ДокументDOM = Неопределено;
    КонецПопытки;
   
    // Завершение работы.
    // Закрытие Объектов.
    ЧтениеXML.Закрыть();
   
    Возврат ДокументDOM;
   
КонецФункции

&НаСервере
Функция ПолучитьЭлементыROW_NativeXLSX(Знач ДокументDOM)
    Перем ЭлементыROW;
   
    Попытка
        ЭлементыROW = ДокументDOM.ПолучитьЭлементыПоИмени("row");
    Исключение
        Сообщить(ОписаниеОшибки());
        Возврат Неопределено;
    КонецПопытки;
   
    // Если строки пусты, то они не включаются в список элементов.
    // Если строки пусты и отдельные ячейки содержат оформление (например задан тип "Текст"),
    // то эти строки включаются в список (содержание: пустые).
    Возврат ЭлементыROW;
   
КонецФункции

&НаСервере
Функция ПолучитьМассивИменКолонокНаЛистеXLSX(ДокументDOM, ЭлементыROW)
    Перем DIMENSION, ДиапазонДанных, ДиапазонКолонок, ПерваяКолонка, ПоследняяКолонка, НомерПервойК, НомерПоследнейК;
    Перем ЭлементыCOL, Колонка;
    Перем МассивИменКолонокXLSX, КолвоКолонокEXCEL;
   
    // DIMENSION.
    Попытка
        DIMENSION = ДокументDOM.ПолучитьЭлементыПоИмени("DIMENSION");
        ДиапазонДанных     = ЗначениеАтрибутаУзлаDOM(DIMENSION[0], "ref");
        ДиапазонКолонок = ЗаменитьОдниСимволыДругими("0123456789", ДиапазонДанных, "");
        ПерваяКолонка     = Лев(ДиапазонКолонок, Найти(ДиапазонКолонок ,":") - 1);
        ПоследняяКолонка= Сред(ДиапазонКолонок, Найти(ДиапазонКолонок ,":") + 1);
        НомерПервойК    = НомерКолонкиДесятичный(ПерваяКолонка);
        НомерПоследнейК    = НомерКолонкиДесятичный(ПоследняяКолонка);
    Исключение
        НомерПоследнейК = Неопределено;
        Сообщить("Не удалось определить конечную колонку диапазона файла XLSX");
    КонецПопытки;
   
    МассивИменКолонокXLSX = Новый Массив;
   
	//ЭлементыCOL = ЭлементыROW[3].ДочерниеУзлы; //Ошибка
	ЭлементыCOL = ЭлементыROW[1].ДочерниеУзлы;
    Для Каждого Колонка ИЗ ЭлементыCOL Цикл
        ИмяКолонки = ЗначениеАтрибутаУзлаDOM(Колонка, "r");
        ИмяКолонки = ЗаменитьОдниСимволыДругими("0123456789", ИмяКолонки, "");
        МассивИменКолонокXLSX.Добавить(ИмяКолонки);
    КонецЦикла;
   
    КолвоКолонокEXCEL = МассивИменКолонокXLSX.Количество();
	//Если НЕ НомерПоследнейК = Неопределено Тогда
	//    Если КолвоКолонокEXCEL < НомерПоследнейК Тогда
	//        Сообщить("Строка заголовков колонок (1-я строка) заполнена не полностью:
	//        |К-во колонок строки меньше объявленной: " + КолвоКолонокEXCEL + "<" + НомерПоследнейК);
	//        ДополнитьМассивИменКолонокXLSX(НомерПоследнейК, МассивИменКолонокXLSX);
	//    ИначеЕсли МассивИменКолонокXLSX.Количество() > НомерПоследнейК Тогда
	//        Сообщить("Строка заголовков колонок (1-я строка) содержит больше колонок, чем объявлено:
	//        |К-во колонок строки больше объявленной:" + КолвоКолонокEXCEL + ">" + НомерПоследнейК);
	//    КонецЕсли;
	//КонецЕсли;
   
    Возврат МассивИменКолонокXLSX;
   
КонецФункции

// Возвращает строковое значение атрибута узла DOM-документа.
//
// Параметры:
//    УзелDOM (УзелDOM) - узел DOM-документа;
//    ИмяАтрибута (Строка) - полное имя атрибута;
//    ЗначениеЕслиНеНайдено (Произвольный) - значение, если атрибут не найден;
//
// Возвращаемое значение:
//    Строка:
//        Строковое значение атрибута узла;
//
&НаСервере
Функция ЗначениеАтрибутаУзлаDOM(УзелDOM, ИмяАтрибута, ЗначениеЕслиНеНайдено = Неопределено)
    Перем АтрибутDOM, Атрибут;
   
    АтрибутDOM = УзелDOM.Атрибуты.ПолучитьИменованныйЭлемент(ИмяАтрибута);
   
    Если АтрибутDOM = Неопределено Тогда
        Для Каждого Атрибут ИЗ УзелDOM.Атрибуты Цикл
            Если Атрибут.ИмяУзла = ИмяАтрибута Тогда
                Возврат Атрибут.Значение;
            КонецЕсли;
        КонецЦикла;
    КонецЕсли;
   
    Если АтрибутDOM = Неопределено Тогда
        Возврат ЗначениеЕслиНеНайдено;
    Иначе
        Возврат АтрибутDOM.Значение;
    КонецЕсли;
   
КонецФункции

// Выполняет замену символов в строке.
//
// Параметры:
//  ЗаменяемыеСимволы - Строка - строка символов, каждый из которых требует замены;
//  Строка            - Строка - исходная строка, в которой требуется замена символов;
//  СимволыЗамены     - Строка - строка символов, на каждый из которых нужно заменить символы параметра ЗаменяемыеСимволы.
//
//  Возвращаемое значение:
//   Строка - строка после замены символов.
//
//  Примечание: функция предназначена для простых случаев, например, для замены латиницы на похожие кириллические символы.
//              Функция не анализирует повторную замену символов, поэтому такой вызов:
//               ЗаменитьОдниСимволыДругими("кр", "карета", "гз") вернёт слово "газета", а
//               ЗаменитьОдниСимволыДругими("кр", "карета", "рк") не вернёт слово "ракета".
//
&НаСервере
Функция ЗаменитьОдниСимволыДругими(ЗаменяемыеСимволы, Строка, СимволыЗамены)
    Перем Результат, НомерСимвола;
   
    Результат = Строка;
   
    Для НомерСимвола = 1 ПО СтрДлина(ЗаменяемыеСимволы) Цикл
        Результат = СтрЗаменить(Результат, Сред(ЗаменяемыеСимволы, НомерСимвола, 1), Сред(СимволыЗамены, НомерСимвола, 1));
    КонецЦикла;
   
    Возврат Результат;
   
КонецФункции

&НаСервере
Функция ПолучитьЧислоВСтепениИзСтроковогоЗначения(Знач ЗначениеЯчейки)
    Перем Поз1Е, Степень;
    Перем Значение;
   
    Если Найти(ЗначениеЯчейки, "E-") > 0 Тогда
        Поз1Е = Найти(ЗначениеЯчейки, "E-");
        Степень = Сред(ЗначениеЯчейки, Поз1Е+2);
        Значение = Лев(ЗначениеЯчейки, Поз1Е-1);
        Попытка
            Степень = Число(Степень);
            Значение = Число(Значение) / Pow(10, Степень);
        Исключение
            Значение = ЗначениеЯчейки;
        КонецПопытки;
    ИначеЕсли Найти(ЗначениеЯчейки, "E+") > 0 Тогда
        Поз1Е = Найти(ЗначениеЯчейки, "E+");
        Степень = Сред(ЗначениеЯчейки, Поз1Е+2);
        Значение = Лев(ЗначениеЯчейки, Поз1Е-1);
        Попытка
            Степень = Число(Степень);
            Значение = Число(Значение) * Pow(10, Степень);
        Исключение
            Значение = ЗначениеЯчейки;
        КонецПопытки;
    Иначе
        Значение = ЗначениеЯчейки;
    КонецЕсли;
   
    Возврат Значение;
   
КонецФункции

&НаСервере
Функция ЭтоПроцентXLSX(Знач ЗначениеЯчейки, Знач ФорматСтиля)
   
    Если ( Найти(ФорматСтиля, "%") > 0 )
        Тогда
        Возврат Истина;
    КонецЕсли;
   
    Возврат Ложь;
   
КонецФункции

&НаСервере
Функция ЭтоБулевоXLSX(ЗначениеЯчейки, ФорматСтиля)
   
    Если (ЗначениеЯчейки = 0 ИЛИ ЗначениеЯчейки = 1)
        И Найти(ВРег(ФорматСтиля), "ИСТИНА") > 0 ИЛИ Найти(ВРег(ФорматСтиля), "ЛОЖЬ") > 0
        ИЛИ Найти(ВРег(ФорматСтиля), "TRUE") > 0 ИЛИ Найти(ВРег(ФорматСтиля), "FALSE") > 0
        Тогда
        Возврат Истина;
    КонецЕсли;
   
    Возврат Ложь;
   
КонецФункции

&НаСервере
Функция КонвертироватьЧислоXLSXвДатуВремя(Знач Число)
    Перем КВоСекунд;
    Перем ВремяРезультат;
   
    // 0,0000115740740740741 = 1 сек.
    // 1                     = 24 часа 00 мин 00 сек.
   
    Если ТипЗнч(Число) = Тип("Число") Тогда
        КВоСекунд = Число * 100000 / 1.15740740740741;
        КВоСекунд = Окр(КВоСекунд);
    Иначе
        Сообщить("Ошибка определения значения типа ""Время"".");
    КонецЕсли;
   
    ВремяРезультат = Дата("19000101000000") + КВоСекунд;
   
    Возврат ВремяРезультат;
   
КонецФункции

&НаСервере
Функция ЭтоДатаXLSX(Знач ЗначениеЯчейки, Знач ФорматСтиля)
   
    Если ЗначениеЯчейки = Цел(ЗначениеЯчейки) И
        ( Найти(ФорматСтиля, "DD") > 0
        ИЛИ Найти(ФорматСтиля, "MM") > 0
        ИЛИ Найти(ФорматСтиля, "YY") > 0
        ИЛИ Найти(ФорматСтиля, "QQ") > 0
        ИЛИ Найти(ФорматСтиля, "WW") > 0 )
        Тогда
        Возврат Истина;
    КонецЕсли;
   
    Возврат Ложь;
   
КонецФункции

&НаСервере
Функция ЭтоВремяXLSX(Знач ЗначениеЯчейки, Знач ФорматСтиля)
   
    Если ЗначениеЯчейки < 1 И
        ( Найти(ФорматСтиля, "HH:") > 0
        ИЛИ Найти(ФорматСтиля, "[HH]:") > 0
        ИЛИ Найти(ФорматСтиля, "[H]:") > 0
        ИЛИ Найти(ФорматСтиля, "MM:") > 0
        ИЛИ Найти(ФорматСтиля, ":SS") > 0 )
        Тогда
        Возврат Истина;
    КонецЕсли;
   
    Возврат Ложь;
   
КонецФункции

&НаСервере
Функция КонвертироватьЧислоXLSXвДату(Знач Число)
    Перем Дата1900, Разница, ДатаРезультат;
   
    Дата1900 = Дата("19000101");
   
    Разница = Число - 2;    // EXCEL ошибочно считает 1900-й год високосным.
    Разница = ?(Разница < 0, 0, Разница);
   
    ДатаРезультат = Дата1900 + Разница * 24 * 60 * 60;
   
    Возврат ДатаРезультат;
   
КонецФункции

&НаСервере
Функция ЭтоЧислоXLSX(Знач ЗначениеЯчейки, Знач ФорматСтиля)
   
    Если ( ВРег(ФорматСтиля) = "GENERAL"
        ИЛИ ВРег(ФорматСтиля) = "STANDARD"
        ИЛИ Найти(ФорматСтиля, "0") > 0 )
        Тогда
        Возврат Истина;
    КонецЕсли;
   
    Возврат Ложь;
   
КонецФункции

&НаСервере
Процедура УдалитьКолонкиСНулевойШириной(ТаблицаРезультат)
    Перем МассивПустыхКолонок;
   
    // Найдем пустые колонки.
    МассивПустыхКолонок = Новый Массив;
    Для Каждого Колонка ИЗ ТаблицаРезультат.Колонки Цикл
        Если Колонка.Ширина = 0 Тогда
            МассивПустыхКолонок.Добавить(Колонка.Имя);
        КонецЕсли;
    КонецЦикла;
   
    // Удалим пустые колонки.
    Для Каждого ПустаяКолонка ИЗ МассивПустыхКолонок Цикл
        ТаблицаРезультат.Колонки.Удалить(ПустаяКолонка);
    КонецЦикла;

КонецПроцедуры

&НаСервере
Функция НомерКолонкиДесятичный(ИмяКолонкиXLSX)
    Перем Латиница, ДлинаНомера, Поз, ит;
    Перем НомерКолонки;
   
    Латиница = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";    // 26.
    ДлинаНомера = СтрДлина(ИмяКолонкиXLSX);
    НомерКолонки = 0;
    Для ит = 1 ПО ДлинаНомера Цикл
        Поз = Найти(Латиница, Сред(ИмяКолонкиXLSX, (ДлинаНомера + 1 - ит), 1));
        НомерКолонки = НомерКолонки + Поз * Pow(26, ит - 1);
    КонецЦикла;
   
    Возврат НомерКолонки;
   
КонецФункции

&НаКлиенте
Процедура Обработать(Команда)
	ТаблицаПередать = Объект.ТЧЭксель;
	ЗаполнитьСправочник(ТаблицаПередать);
КонецПроцедуры

#КонецОбласти

#КонецОбласти
